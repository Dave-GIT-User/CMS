    <p>MongoDB enables nested records, either singly or in arrays, and possibly 
        at further levels of nesting. How can one access and maintain this inner 
        data? The get operation is trivial, and not discussed here.
    </p>
    <p> A single method at the API handles adds, deletes, and edits of subdocuments. 
        MongoDB treates subdocuments specially. One does not save the subdocument, 
        but rather update the children array and then save the parent document. 
        For further information, please see 
        <a href="https://mongoosejs.com/docs/subdocs.html" 
            target="_blank">https://mongoosejs.com/docs/subdocs.html
        </a>
    </p>
    <hr>
    <pre>
    var express = require('express');
    const Document = require('../models/document');
    const sequenceGenerator = require('./sequenceGenerator');
    //const util = require('./util');
    
    var router = express.Router();
    
    // update a single document
    // The difference between this and the put
    // method of documents.js is that it 
    // is for adding, deleting or updating child documents
    router.post('/:id', async (req, res, next) => %7B
        try %7B
            index = req.params.id;
            const  document = await Document.findOne(%7B"id": req.body.id%7D); // the parent document
            // do some analysis to determine the operation.
            var destCount = 0;
            for (let child of document.children) %7B
                destCount++;
            %7D
            var srcCount = 0;
            for (let child of req.body.children) %7B
                srcCount++;
            %7D
    
            var operation = "";
            if (srcCount > destCount) %7B
                operation = "add";
            %7D else if (srcCount == destCount) %7B
                operation = "edit";
            %7D else operation = "delete";
    
            var id = "0"; // only needed for add, ignored at the client otherwise.
            switch (operation) %7B
                case "delete":
                    deletedChild = document.children[index]; 
                    await deletedChild.deleteOne();
                    break;
                case "edit":
                    req.body.children[index].author = document.author;
                    document.children[index] = req.body.children[index];
                    break;
                case "add": 
                    index = srcCount - 1; // ignore the index passed in req
                    id = await sequenceGenerator.nextId("documents");
                    const author = document.author;
                    const name = req.body.children[index].name;
                    const description = req.body.children[index].description;
                    const url = req.body.children[index].url;
                    await document.children.push(%7Bid: id, author: author, name: name, description: description, url: url%7D);
                    break;
                default:
                    throw new Error('Invalid child document operation');
            %7D
            await document.save()
            .then((response) => %7B 
                res.status(201).json(%7B
                    statusMessage: "Message added successfully.",
                    feedback: id 
                %7D);
            %7D)
        %7D catch(error) %7B
                res.status(500).json(%7B
                message: 'An error occurred',
                error: error
            %7D);
        %7D
    %7D);
    
    module.exports = router; 
    </pre>